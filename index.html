<!DOCTYPE html> 
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>電波人間用QRコード自動生成ツール</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        #qrcode canvas {
            width: 100% !important;
            max-width: 400px;
            height: auto !important;
        }
        #generatedString {
            margin-top: 10px;
            font-size: 18px;
            word-wrap: break-word;
        }
        #saveButton {
            margin-top: 10px;
            display: none;
            padding: 10px 20px;
            font-size: 16px;
        }
        .description {
            font-size: 12px;
            color: gray;
            margin-top: 10px;
        }
        .selectGroup {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .selectGroup div {
            margin-right: 20px;
            min-width: 120px;
        }
        @media (max-width: 600px) {
            .selectGroup div {
                margin-right: 0;
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>

<body>

    <h2>電波人間用QRコード自動生成ツール</h2>

    <input type="number" id="stringLength" placeholder="文字列の長さ (1-493)" min="1" max="493" value="126">
    <button onclick="generateQRCode()">QRコードを生成</button>

    <div class="description">※ランダムでQRを生成します。意図的なQRは作れません。</div>

    <div id="qrcode"></div>
    <div id="generatedString"></div>

    <div id="qrCount">QRコード生成回数: 0</div>

    <!-- 全セレクトボックス -->
    <div class="selectGroup">
        <div>
            <strong>回避率</strong>
            <select id="avoidanceSelect">
                <option value="">選択してください</option>
                <option value="回避0">回避0</option>
                <option value="回避3+">回避3+</option>
                <option value="回避3-">回避3-</option>
                <option value="回避6">回避6</option>
                <option value="回避10">回避10</option>
                <option value="回避15">回避15</option>
            </select>
        </div>

        <div>
            <strong>体格</strong>
            <select id="physiqueSelect">
                <option value="">選択してください</option>
                <option value="最速">最速</option>
                <option value="準速">準速</option>
                <option value="中間">中間</option>
                <option value="準大">準大</option>
                <option value="最大">最大</option>
            </select>
        </div>

        <div>
            <strong>色</strong>
            <select id="colorSelect">
                <option value="">選択してください</option>
                <option value="黒">黒</option>
                <option value="赤">赤</option>
                <option value="青">青</option>
                <option value="黄">黄</option>
                <option value="橙">橙</option>
                <option value="緑">緑</option>
                <option value="水">水</option>
                <option value="紫">紫</option>
                <option value="白">白</option>
                <option value="薄黒">薄黒</option>
                <option value="薄赤">薄赤</option>
                <option value="薄青">薄青</option>
                <option value="薄黄">薄黄</option>
                <option value="薄橙">薄橙</option>
                <option value="薄緑">薄緑</option>
                <option value="薄水">薄水</option>
                <option value="薄紫">薄紫</option>
                <option value="薄白">薄白</option>
                <option value="濃黒">濃黒</option>
                <option value="濃赤">濃赤</option>
                <option value="濃青">濃青</option>
                <option value="濃黄">濃黄</option>
                <option value="濃橙">濃橙</option>
                <option value="濃緑">濃緑</option>
                <option value="濃水">濃水</option>
                <option value="濃紫">濃紫</option>
                <option value="濃白">濃白</option>
            </select>
        </div>

        <div>
            <strong>頭</strong>
            <select id="headSelect">
                <option value="">選択してください</option>
                <option value="よこまる">よこまる</option>
                <option value="かどまる">かどまる</option>
                <option value="まる">まる</option>
                <option value="さんかく">さんかく</option>
                <option value="しかく">しかく</option>
                <option value="たてまる">たてまる</option>
            </select>
        </div>

        <div>
            <strong>アンテナ</strong>
            <select id="antennaSelect">
                <option value="">選択してください</option>
                <option value="アンテナなし">アンテナなし</option>
                <option value="ふっかつ">ふっかつ</option>
                <option value="かいふく">かいふく</option>
                <option value="むてき">むてき</option>
                <option value="よけにくい">よけにくい</option>
                <option value="ノックダウン">ノックダウン</option>
                <option value="なおす">なおす</option>
                <option value="ぞくせいなおす">ぞくせいなおす</option>
                <option value="こうふん">こうふん</option>
                <option value="あしもとガード">あしもとガード</option>
                <option value="おそくなれ">おそくなれ</option>
                <option value="よわくなれ">よわくなれ</option>
                <option value="やわくなれ">やわくなれ</option>
                <option value="はやくなれ">はやくなれ</option>
                <option value="つよくなれ">つよくなれ</option>
                <option value="かたくなれ">かたくなれ</option>
                <option value="かわしやすい">かわしやすい</option>
                <option value="どくになれ">どくになれ</option>
                <option value="めかくし">めかくし</option>
                <option value="しびれさせる">しびれさせる</option>
                <option value="ねむらせる">ねむらせる</option>
                <option value="げどく">げどく</option>
                <option value="しびれとる">しびれとる</option>
                <option value="めざめる">めざめる</option>
                <option value="単体火">単体火</option>
                <option value="単体水">単体水</option>
                <option value="単体電気">単体電気</option>
                <option value="単体土">単体土</option>
                <option value="単体風">単体風</option>
                <option value="単体氷">単体氷</option>
                <option value="単体闇">単体闇</option>
                <option value="単体光">単体光</option>
                <option value="3体火">3体火</option>
                <option value="3体水">3体水</option>
                <option value="3体電気">3体電気</option>
                <option value="3体土">3体土</option>
                <option value="3体風">3体風</option>
                <option value="3体氷">3体氷</option>
                <option value="3体闇">3体闇</option>
                <option value="3体光">3体光</option>
            </select>
        </div>

        <div>
            <strong>特徴</strong>
            <select id="featureSelect">
                <option value="">選択してください</option>
                <option value="親子">親子</option>
                <option value="双子">双子</option>
                <option value="顔素材">顔素材</option>
                <option value="かわいい">かわいい</option>
                <option value="かっこいい">かっこいい</option>
                <option value="髪素材">髪素材</option>
                <option value="眉素材">眉素材</option>
                <option value="目素材">目素材</option>
                <option value="鼻素材">鼻素材</option>
                <option value="口素材">口素材</option>
                <option value="頬素材">頬素材</option>
                <option value="顔色素材">顔色素材</option>
            </select>
        </div>
    </div>

    <!-- QR保存ボタン -->
    <button id="saveButton" onclick="saveQRCode()">QRコード画像を保存</button>
    <div class="description" id="saveDescription" style="display:none;">※選択肢を押さなくても保存できます。</div>

    <!-- ボタン2つ -->
    <button id="physiqueTableButton" style="margin-top:10px;" onclick="togglePhysiqueTable()">体格表を表示</button>
    <button id="historyButton" style="margin-top:10px; margin-left:10px;" onclick="toggleHistory()">履歴を表示</button>

    <!-- ★ 履歴削除ボタン -->
    <button id="clearHistoryButton" style="margin-top:10px; margin-left:10px; display:none;" onclick="clearHistory()">
        履歴を削除
    </button>

    <!-- 履歴 -->
    <div id="historyContainer" style="display:none; margin-top:15px;">
        <h3>生成履歴</h3>
        <div id="history" style="display:flex; flex-wrap:wrap; justify-content:center; gap:10px;"></div>
    </div>

    <!-- 体格表 -->
    <div id="physiqueTableContainer" style="display:none; margin-top:15px;">
        <img id="physiqueTableImage"
             src="https://github.com/chocomint024/DenpaQR/blob/main/%E4%BD%93%E6%A0%BC%E8%A1%A8.png?raw=true"
             alt="体格表" style="max-width:100%; height:auto;">
    </div>

<script>
let qrCodeElement;
let qrCodeCount = 0;

// ★ 履歴専用カウンター
let historyCount = 0;

// QR生成
function generateQRCode() {
    const maxLength = parseInt(document.getElementById("stringLength").value);
    if (isNaN(maxLength) || maxLength < 1 || maxLength > 493) {
        alert("1〜493 の範囲で入力してください。");
        return;
    }

    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
    let randomString = "";
    for (let i = 0; i < maxLength; i++) {
        randomString += chars.charAt(Math.floor(Math.random() * chars.length));
    }

    document.getElementById("qrcode").innerHTML = "";
    qrCodeElement = document.createElement("div");
    document.getElementById("qrcode").appendChild(qrCodeElement);

    const size = 400;

    new QRCode(qrCodeElement, {
        text: randomString,
        width: size,
        height: size
    });

    const original = qrCodeElement.querySelector("canvas");
    const bordered = document.createElement("canvas");

    const border = 30;
    bordered.width = size + border * 2;
    bordered.height = size + border * 2;

    const ctx = bordered.getContext("2d");
    ctx.fillStyle = "white";
    ctx.fillRect(0, 0, bordered.width, bordered.height);
    ctx.drawImage(original, border, border, size, size);

    qrCodeElement.innerHTML = "";
    qrCodeElement.appendChild(bordered);

    document.getElementById("generatedString").innerHTML = "生成した文字列: " + randomString;
    document.getElementById("saveButton").style.display = "inline";
    document.getElementById("saveDescription").style.display = "block";

    resetSelects();

    // ★★ 履歴を追加（回数）
    addHistory(bordered.toDataURL("image/png"));

    qrCodeCount++;
    document.getElementById("qrCount").innerText = "QRコード生成回数: " + qrCodeCount;
}

// 選択肢リセット
function resetSelects() {
    avoidanceSelect.selectedIndex = 0;
    physiqueSelect.selectedIndex = 0;
    colorSelect.selectedIndex = 0;
    headSelect.selectedIndex = 0;
    antennaSelect.selectedIndex = 0;
    featureSelect.selectedIndex = 0;
}

// 保存
function saveQRCode() {
    const canvas = qrCodeElement.querySelector("canvas");
    if (!canvas) return;

    const imgSrc = canvas.toDataURL("image/png");
    const link = document.createElement("a");

    const selected = [
        avoidanceSelect.value,
        physiqueSelect.value,
        colorSelect.value,
        headSelect.value,
        antennaSelect.value,
        featureSelect.value
    ].filter(v => v).join("_");

    link.download = selected ? `qrcode_${selected}.png` : "qrcode.png";
    link.href = imgSrc;
    link.click();
}

// ★★ 履歴追加（回数表示）
function addHistory(imgSrc) {
    historyCount++;

    const history = document.getElementById("history");

    const box = document.createElement("div");
    box.style.border = "1px solid #ccc";
    box.style.padding = "5px";
    box.style.background = "white";
    box.style.textAlign = "center";

    const img = document.createElement("img");
    img.src = imgSrc;
    img.style.width = "100px";
    img.style.cursor = "pointer";

    img.onclick = () => {
        const w = window.open("");
        w.document.write(`<img src="${imgSrc}" style="width:400px;">`);
        w.document.title = `${historyCount}回目のQRコード`;
    };

    const label = document.createElement("div");
    label.innerText = `${historyCount}回目`;
    label.style.fontSize = "12px";

    box.appendChild(img);
    box.appendChild(label);
    history.appendChild(box);

    // ★ 履歴があるときだけ削除ボタンを表示
    document.getElementById("clearHistoryButton").style.display = "inline-block";
}

// ★★ 履歴削除
function clearHistory() {
    document.getElementById("history").innerHTML = "";
    historyCount = 0;

    // ボタンを隠す
    document.getElementById("clearHistoryButton").style.display = "none";
}

// 履歴表示切換
function toggleHistory() {
    const c = document.getElementById("historyContainer");
    c.style.display = c.style.display === "none" ? "block" : "none";
    historyButton.innerText = c.style.display === "none" ? "履歴を表示" : "履歴を非表示";

    // 開いたときだけ削除ボタンを出す
    if (c.style.display === "block" && historyCount > 0) {
        clearHistoryButton.style.display = "inline-block";
    } else {
        clearHistoryButton.style.display = "none";
    }
}

// 体格表切換
function togglePhysiqueTable() {
    const c = document.getElementById("physiqueTableContainer");
    c.style.display = c.style.display === "none" ? "block" : "none";
    physiqueTableButton.innerText = c.style.display === "none" ? "体格表を表示" : "体格表を非表示";
}
</script>

</body>
</html>
